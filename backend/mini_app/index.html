<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-–ø–æ–º–æ—â–Ω–∏–∫ –ì–ª–∞–≤—ã –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>ü§ñ AI-–ø–æ–º–æ—â–Ω–∏–∫ –ì–ª–∞–≤—ã –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞</h1>
            <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–±–ª–µ–º –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
            <div class="city-badge">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥</div>

            <!-- –°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è -->
            <div id="connection-status" class="connection-status">
                <span class="status-dot connected"></span>
                <span class="status-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">
                üìä –î–∞—à–±–æ—Ä–¥
            </button>
            <button class="nav-tab" onclick="switchTab('clusters')">
                üéØ –ö–ª–∞—Å—Ç–µ—Ä—ã
            </button>
            <button class="nav-tab" onclick="switchTab('how-it-works')">
                üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
            </button>
        </div>

        <!-- –î–∞—à–±–æ—Ä–¥ -->
        <div id="dashboard-tab" class="tab-content active">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-grid">
                <div class="stat-card critical">
                    <div class="stat-number" id="critical-count">0</div>
                    <div class="stat-label">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-count">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-number" id="last-hour-count">0</div>
                    <div class="stat-label">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-number" id="avg-priority">0.0</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
                </div>
            </div>

            <!-- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã -->
            <div class="section">
                <div class="section-title">
                    <h2>üî• –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞</h2>
                    <div class="filter-controls">
                        <select id="time-filter" onchange="loadDashboard()">
                            <option value="24h">–ó–∞ 24 —á–∞—Å–∞</option>
                            <option value="7d">–ó–∞ 7 –¥–Ω–µ–π</option>
                        </select>
                        <button onclick="loadDashboard()" class="btn-refresh">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                </div>
                <div id="problems-list" class="problems-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                    </div>
                </div>
            </div>

            <!-- –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
            <div class="section">
                <div class="section-title">
                    <h2>üèÜ –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–æ–±–ª–µ–º</h2>
                </div>
                <div id="categories-list" class="categories-list">
                    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è JavaScript -->
                </div>
            </div>

            <!-- –û—Ç—á–µ—Ç—ã -->
            <div class="section">
                <div class="section-title">
                    <h2>üìÑ –û—Ç—á–µ—Ç—ã</h2>
                </div>
                <div class="report-actions">
                    <button class="btn btn-success" onclick="generateReport()">
                        üìä –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç
                    </button>
                </div>
            </div>
        </div>

        <!-- –ö–ª–∞—Å—Ç–µ—Ä—ã -->
        <div id="clusters-tab" class="tab-content">
            <div class="section">
                <div class="section-title">
                    <h2>üéØ –ö–ª–∞—Å—Ç–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º</h2>
                    <button onclick="loadClusters()" class="btn-refresh">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                <p class="section-subtitle">–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é</p>

                <div id="clusters-list" class="clusters-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç" -->
        <div id="how-it-works-tab" class="tab-content">
            <div class="section">
                <div class="section-title">
                    <h2>üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç AI-–ø–æ–º–æ—â–Ω–∏–∫</h2>
                    <span class="city-badge">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</span>
                </div>

                <!-- –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã -->
                <div class="workflow">
                    <!-- –®–∞–≥ 1 -->
                    <div class="workflow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-icon">üì∞</div>
                            <h3>–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ 15+ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</h3>
                            <p>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑:</p>
                            <ul class="source-list">
                                <li><strong>–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏:</strong> Telegram, –í–ö–æ–Ω—Ç–∞–∫—Ç–µ</li>
                                <li><strong>–ù–æ–≤–æ—Å—Ç–Ω—ã–µ –ø–æ—Ä—Ç–∞–ª—ã:</strong> –ï1.ru, 66.ru</li>
                                <li><strong>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:</strong> –°–∞–π—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</li>
                                <li><strong>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã:</strong> –î–¢–ü, –ú–ß–°, –ø–æ–ª–∏—Ü–∏—è</li>
                            </ul>
                        </div>
                    </div>

                    <!-- –®–∞–≥ 2 -->
                    <div class="workflow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-icon">ü§ñ</div>
                            <h3>AI-–∞–Ω–∞–ª–∏–∑ GigaChat</h3>
                            <p>–ù–µ–π—Ä–æ—Å–µ—Ç—å –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é –Ω–æ–≤–æ—Å—Ç—å:</p>
                            <ul class="source-list">
                                <li><strong>–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç</strong> –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–î–æ—Ä–æ–≥–∏, –ñ–ö–•, –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç...)</li>
                                <li><strong>–û—Ü–µ–Ω–∏–≤–∞–µ—Ç</strong> –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å (0-5)</li>
                                <li><strong>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç</strong> —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</li>
                                <li><strong>–ò–∑–≤–ª–µ–∫–∞–µ—Ç</strong> –∫–ª—é—á–µ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</li>
                            </ul>
                        </div>
                    </div>

                    <!-- –®–∞–≥ 3 -->
                    <div class="workflow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-icon">üìä</div>
                            <h3>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑</h3>
                            <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º –¥–∞—à–±–æ—Ä–¥–µ:</p>
                            <ul class="source-list">
                                <li><strong>–î–∞—à–±–æ—Ä–¥:</strong> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã</li>
                                <li><strong>–ö–ª–∞—Å—Ç–µ—Ä—ã:</strong> –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å—Ö–æ–∂–∏—Ö –ø—Ä–æ–±–ª–µ–º</li>
                                <li><strong>–û–ø–æ–≤–µ—â–µ–Ω–∏—è:</strong> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö</li>
                                <li><strong>–û—Ç—á–µ—Ç—ã:</strong> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∏ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ -->
                <div class="section" style="margin-top: 30px;">
                    <h3>‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h3>
                    <div class="tech-features">
                        <div class="tech-feature">
                            <div class="feature-icon">‚ö°</div>
                            <div class="feature-text">
                                <strong>–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:</strong> –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                            </div>
                        </div>
                        <div class="tech-feature">
                            <div class="feature-icon">üß†</div>
                            <div class="feature-text">
                                <strong>AI-–∞–Ω–∞–ª–∏–∑:</strong> GigaChat –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤–æ—Å—Ç–∏
                            </div>
                        </div>
                        <div class="tech-feature">
                            <div class="feature-icon">üìà</div>
                            <div class="feature-text">
                                <strong>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:</strong> –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ç—Ä–µ–Ω–¥—ã
                            </div>
                        </div>
                        <div class="tech-feature">
                            <div class="feature-icon">üîí</div>
                            <div class="feature-text">
                                <strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong> –¢–æ–ª—å–∫–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notification-container"></div>

    <script>
        // Telegram WebApp
        const tg = window.Telegram.WebApp;

        // –¢–µ–∫—É—â–∞—è –≤–∫–ª–∞–¥–∫–∞
        let currentTab = 'dashboard';

        // WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        let ws = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            if (tg) {
                tg.expand();
                tg.MainButton.hide();
                console.log('‚úÖ Telegram WebApp –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            loadDashboard();

            // –ü–æ–¥–∫–ª—é—á–∞–µ–º WebSocket
            connectWebSocket();

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(loadDashboard, 30000);
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            currentTab = tabName;

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // –£–±–∏—Ä–∞–µ–º active —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            const activeTab = document.getElementById(`${tabName}-tab`);
            if (activeTab) {
                activeTab.classList.add('active');
            }

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            const activeBtn = document.querySelector(`.nav-tab:nth-child(${tabName === 'dashboard' ? 1 : tabName === 'clusters' ? 2 : 3})`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'dashboard') {
                loadDashboard();
            } else if (tabName === 'clusters') {
                loadClusters();
            }
        }

        // WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        function connectWebSocket() {
            const wsUrl = 'ws://localhost:8000/ws';

            try {
                ws = new WebSocket(wsUrl);
                updateConnectionStatus('connecting');

                ws.onopen = function() {
                    console.log('‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
                    updateConnectionStatus('connected');

                    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    ws.send(JSON.stringify({ type: 'get_stats' }));
                };

                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        console.log('üì© WebSocket —Å–æ–æ–±—â–µ–Ω–∏–µ:', data);
                        handleWebSocketMessage(data);
                    } catch (e) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ WebSocket:', e);
                    }
                };

                ws.onclose = function() {
                    console.log('üîå WebSocket –æ—Ç–∫–ª—é—á–µ–Ω');
                    updateConnectionStatus('disconnected');

                    // –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(connectWebSocket, 3000);
                };

                ws.onerror = function(error) {
                    console.error('‚ùå WebSocket –æ—à–∏–±–∫–∞:', error);
                    updateConnectionStatus('disconnected');
                };

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è WebSocket:', error);
                updateConnectionStatus('disconnected');
            }
        }

        function handleWebSocketMessage(data) {
            switch (data.type) {
                case 'alert':
                    showAlert(data.data);
                    break;
                case 'new_problem':
                    addNewProblem(data.data);
                    break;
                case 'stats_update':
                    updateStats(data.data);
                    break;
                case 'current_stats':
                    updateStats(data.data);
                    break;
                case 'pong':
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º pong
                    break;
            }
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connection-status');
            if (!statusElement) return;

            const dot = statusElement.querySelector('.status-dot');
            const text = statusElement.querySelector('.status-text');

            statusElement.className = `connection-status ${status}`;
            dot.className = `status-dot ${status}`;

            switch (status) {
                case 'connected':
                    text.textContent = '–í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏';
                    break;
                case 'disconnected':
                    text.textContent = '–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
                    break;
                case 'connecting':
                    text.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
                    break;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞
        async function loadDashboard() {
            try {
                console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞...');

                const timeframe = document.getElementById('time-filter').value;
                const response = await fetch(`http://localhost:8000/api/stats?timeframe=${timeframe}`);

                if (!response.ok) {
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞: ${response.status}`);
                }

                const data = await response.json();
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', data);

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('critical-count').textContent = data.critical || 0;
                document.getElementById('total-count').textContent = data.total || 0;
                document.getElementById('last-hour-count').textContent = data.total_last_hour || 0;
                document.getElementById('avg-priority').textContent = data.avg_priority ? data.avg_priority.toFixed(1) : "0.0";

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã
                displayProblems(data.critical_issues || []);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                displayCategories(data.by_category || []);

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞:', error);
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ.', 'warning');
                showDemoData();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º
        async function loadAllProblems() {
            try {
                const response = await fetch('http://localhost:8000/api/problems?limit=50');
                const data = await response.json();

                if (data.problems && data.problems.length > 0) {
                    displayProblems(data.problems);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–±–ª–µ–º:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        async function loadClusters() {
            try {
                const response = await fetch('http://localhost:8000/api/clusters');
                const data = await response.json();

                if (data.clusters && data.clusters.length > 0) {
                    displayClusters(data.clusters);
                } else {
                    document.getElementById('clusters-list').innerHTML = `
                        <div class="empty-state">
                            <div style="font-size: 48px; color: #ccc;">üìä</div>
                            <p>–ö–ª–∞—Å—Ç–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                            <p class="empty-subtitle">–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤:', error);
                document.getElementById('clusters-list').innerHTML = `
                    <div class="error-state">
                        <div style="font-size: 48px; color: #ff6b6b;">‚ùå</div>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä—ã</p>
                        <button onclick="loadClusters()" class="btn-retry">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                    </div>
                `;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
        function displayProblems(problems) {
            const container = document.getElementById('problems-list');

            if (!problems || problems.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 48px; color: #ccc;">‚úÖ</div>
                        <p>–ù–µ—Ç –ø—Ä–æ–±–ª–µ–º –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>
                        <p class="empty-subtitle">–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ</p>
                    </div>
                `;
                return;
            }

            let html = '';
            problems.forEach(problem => {
                const time = formatTime(problem.time || problem.created_at);
                const priority = problem.priority || problem.metadata?.criticality || 0;
                const priorityClass = priority >= 2 ? 'critical' : (priority >= 1 ? 'warning' : 'normal');
                const sentiment = problem.sentiment || problem.metadata?.sentiment || 'neutral';
                const location = problem.location || '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥';
                const sourceUrl = problem.metadata?.source_url || problem.source_info || '';

                html += `
                    <div class="problem-card ${priorityClass}">
                        <div class="problem-header">
                            <span class="problem-category">${problem.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}</span>
                            <span class="problem-criticality">${getCriticalityIcon(priority)}</span>
                            <span class="problem-time">${time}</span>
                        </div>

                        <div class="problem-summary">
                            <strong>${problem.text || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</strong>
                        </div>

                        <div class="problem-details">
                            <div class="problem-location">
                                <span>üìç ${location}</span>
                                ${problem.metadata?.time_info ? `<span class="time-mentioned">üïê ${problem.metadata.time_info}</span>` : ''}
                            </div>

                            <div class="problem-meta">
                                <span class="sentiment ${sentiment}">
                                    ${getSentimentIcon(sentiment)} ${sentiment}
                                </span>

                                ${sourceUrl ? `
                                <a href="${sourceUrl}"
                                   target="_blank"
                                   class="source-link"
                                   title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫—É">
                                    üîó –ò—Å—Ç–æ—á–Ω–∏–∫
                                </a>
                                ` : ''}

                                ${problem.metadata?.original_preview ? `
                                <button onclick="showFullText('${problem.metadata.original_preview.replace(/'/g, "\\'")}')"
                                        class="btn-more">
                                    üìù –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function displayCategories(categories) {
            const container = document.getElementById('categories-list');

            if (!categories || categories.length === 0) {
                container.innerHTML = '<p class="empty">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</p>';
                return;
            }

            let html = '';
            categories.forEach(cat => {
                const percentage = cat.count > 0 ? Math.min(100, (cat.count / 10) * 100) : 0;

                html += `
                    <div class="category-item">
                        <div class="category-info">
                            <span class="category-name">${cat.category}</span>
                            <span class="category-count">${cat.count}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        function displayClusters(clusters) {
            const container = document.getElementById('clusters-list');

            let html = '';
            clusters.forEach(cluster => {
                html += `
                    <div class="cluster-card severity-${cluster.severity}">
                        <div class="cluster-header">
                            <span class="cluster-category">${cluster.category}</span>
                            <span class="cluster-location">üìç ${cluster.location}</span>
                            <span class="cluster-frequency">${cluster.frequency} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</span>
                        </div>

                        <div class="cluster-examples">
                            <strong>–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º:</strong>
                            <ul>
                                ${cluster.examples.map(example =>
                                    `<li>${example.substring(0, 80)}...</li>`
                                ).join('')}
                            </ul>
                        </div>

                        <div class="cluster-footer">
                            <span class="cluster-severity">
                                ${cluster.icon || '‚ö†Ô∏è'} –°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å: ${cluster.severity}/3
                            </span>
                            <button onclick="viewClusterProblems('${cluster.category}', '${cluster.location}')"
                                    class="btn-view">
                                –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–æ–±–ª–µ–º—ã —á–µ—Ä–µ–∑ WebSocket
        function addNewProblem(problem) {
            const container = document.getElementById('problems-list');

            // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—É—Å—Ç–æ–π –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º", –æ—á–∏—â–∞–µ–º
            if (container.innerHTML.includes('empty-state')) {
                container.innerHTML = '';
            }

            const time = formatTime(problem.timestamp || problem.time);
            const priorityClass = problem.priority >= 2 ? 'critical' : 'warning';
            const sentiment = problem.sentiment || 'neutral';

            const problemHtml = `
                <div class="problem-card ${priorityClass} new-problem">
                    <div class="problem-header">
                        <span class="problem-category">${problem.category}</span>
                        <span class="problem-criticality">${getCriticalityIcon(problem.priority)}</span>
                        <span class="problem-time">${time} (–Ω–æ–≤–æ–µ)</span>
                    </div>

                    <div class="problem-summary">
                        <strong>${problem.text}</strong>
                    </div>

                    <div class="problem-details">
                        <div class="problem-location">
                            <span>üìç ${problem.location}</span>
                        </div>

                        <div class="problem-meta">
                            <span class="sentiment ${sentiment}">
                                ${getSentimentIcon(sentiment)}
                            </span>
                        </div>
                    </div>
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
            container.insertAdjacentHTML('afterbegin', problemHtml);

            // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å "–Ω–æ–≤–æ–µ" —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                const newElement = container.querySelector('.new-problem');
                if (newElement) {
                    newElement.classList.remove('new-problem');
                }
            }, 5000);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification(`–ù–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞: ${problem.category} - ${problem.location}`, 'info');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(stats) {
            if (stats.total_last_hour !== undefined) {
                document.getElementById('last-hour-count').textContent = stats.total_last_hour;
            }
            if (stats.critical_last_hour !== undefined) {
                document.getElementById('critical-count').textContent = stats.critical_last_hour;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
        function showDemoData() {
            console.log('üì± –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ...');

            // –î–µ–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('critical-count').textContent = "3";
            document.getElementById('total-count').textContent = "15";
            document.getElementById('last-hour-count').textContent = "5";
            document.getElementById('avg-priority').textContent = "1.8";

            // –î–µ–º–æ –ø—Ä–æ–±–ª–µ–º—ã
            const demoProblems = [
                {
                    text: "–ë–æ–ª—å—à–∞—è —è–º–∞ –Ω–∞ –ø—Ä–æ–µ–∑–∂–µ–π —á–∞—Å—Ç–∏ —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥–≤–∏–∂–µ–Ω–∏–µ –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–æ",
                    category: "–î–æ—Ä–æ–≥–∏",
                    location: "—É–ª. –õ–µ–Ω–∏–Ω–∞, 15",
                    priority: 2,
                    sentiment: "–Ω–µ–≥–∞—Ç–∏–≤–Ω–∞—è",
                    metadata: {
                        criticality: 2,
                        time_info: "—Å–µ–≥–æ–¥–Ω—è —É—Ç—Ä–æ–º",
                        source_url: "https://t.me/ekb_news",
                        original_preview: "–ù–∞ —É–ª–∏—Ü–µ –õ–µ–Ω–∏–Ω–∞ –æ–±—Ä–∞–∑–æ–≤–∞–ª–∞—Å—å —è–º–∞ —Ä–∞–∑–º–µ—Ä–æ–º 1x1 –º–µ—Ç—Ä..."
                    }
                },
                {
                    text: "–ü—Ä–æ—Ä—ã–≤ —Ç—Ä—É–±—ã –Ω–∞ —É–ª–∏—Ü–µ –ú–∞–ª—ã—à–µ–≤–∞, –ø–æ–¥—Ç–æ–ø–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∑–∂–µ–π —á–∞—Å—Ç–∏",
                    category: "–ñ–ö–•",
                    location: "—É–ª. –ú–∞–ª—ã—à–µ–≤–∞, 58",
                    priority: 3,
                    sentiment: "–Ω–µ–≥–∞—Ç–∏–≤–Ω–∞—è",
                    metadata: {
                        criticality: 3,
                        time_info: "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥",
                        source_url: "https://66.ru",
                        original_preview: "–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ—Ä—ã–≤–∞ —Ç—Ä—É–±—ã –∑–∞—Ç–æ–ø–ª–µ–Ω–∞ –ø—Ä–æ–µ–∑–∂–∞—è —á–∞—Å—Ç—å..."
                    }
                }
            ];

            displayProblems(demoProblems);

            // –î–µ–º–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const demoCategories = [
                { category: "–î–æ—Ä–æ–≥–∏", count: 7 },
                { category: "–ñ–ö–•", count: 4 },
                { category: "–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ", count: 3 },
                { category: "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", count: 1 }
            ];

            displayCategories(demoCategories);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
        async function generateReport() {
            try {
                showNotification('‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç—á–µ—Ç...', 'info');

                const response = await fetch('http://localhost:8000/api/generate_report');
                const data = await response.json();

                if (data.success) {
                    const userChoice = confirm("–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!\n\n–ù–∞–∂–º–∏—Ç–µ –û–ö, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ.\n–û—Ç–º–µ–Ω–∞ - —á—Ç–æ–±—ã —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª.");

                    if (userChoice) {
                        window.open(`http://localhost:8000/api/view_report/${data.filename}`, '_blank');
                        showNotification('üìÑ –û—Ç—á–µ—Ç –æ—Ç–∫—Ä—ã—Ç –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ', 'success');
                    } else {
                        window.open(`http://localhost:8000${data.download_url}`, '_blank');
                        showNotification('‚¨áÔ∏è –û—Ç—á–µ—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...', 'success');
                    }
                } else {
                    throw new Error(data.message);
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞:', error);
                showNotification('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç', 'error');
            }
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç—á–µ—Ç–∞
        async function viewLastReport() {
            showNotification('üìÇ –ò—â—É –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç...', 'info');

            // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä
            const reportContent = `
                ============================================================
                –û–¢–ß–ï–¢ AI-–ü–û–ú–û–©–ù–ò–ö–ê –ì–õ–ê–í–´ –ï–ö–ê–¢–ï–†–ò–ù–ë–£–†–ì–ê
                –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: ${new Date().toLocaleString('ru-RU')}
                ============================================================

                üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
                  ‚Ä¢ –ü—Ä–æ–±–ª–µ–º –∑–∞ 24 —á–∞—Å–∞: 15
                  ‚Ä¢ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º: 3
                  ‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤: 2

                üèÜ –¢–û–ü-5 –ö–ê–¢–ï–ì–û–†–ò–ô –ü–†–û–ë–õ–ï–ú:
                  ‚Ä¢ –î–æ—Ä–æ–≥–∏: 7 –ø—Ä–æ–±–ª–µ–º
                  ‚Ä¢ –ñ–ö–•: 4 –ø—Ä–æ–±–ª–µ–º—ã
                  ‚Ä¢ –ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: 3 –ø—Ä–æ–±–ª–µ–º—ã
                  ‚Ä¢ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: 1 –ø—Ä–æ–±–ª–µ–º–∞

                üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –°–ò–¢–£–ê–¶–ò–ò:
                  1. –ü—Ä–æ—Ä—ã–≤ —Ç—Ä—É–±—ã –Ω–∞ —É–ª. –ú–∞–ª—ã—à–µ–≤–∞, 58
                  2. –ë–æ–ª—å—à–∞—è —è–º–∞ –Ω–∞ —É–ª. –õ–µ–Ω–∏–Ω–∞, 15
                  3. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–≤–µ—Ç–∞ –≤ —Ä–∞–π–æ–Ω–µ –£—Ä–∞–ª–º–∞—à

                üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:
                  1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
                  2. –£—Å–∏–ª–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–∞—Å—Ç—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                  3. –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å–ª—É–∂–±

                ============================================================
            `;

            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                <head>
                    <title>–î–µ–º–æ-–æ—Ç—á–µ—Ç</title>
                    <style>
                        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
                        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                        .header { background: #007bff; color: white; padding: 20px; border-radius: 5px; margin-bottom: 20px; text-align: center; }
                        pre { background: #f8f9fa; padding: 20px; border-radius: 5px; white-space: pre-wrap; font-size: 14px; line-height: 1.5; }
                        .actions { margin-top: 20px; text-align: center; }
                        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 0 5px; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h2>üìÑ –î–µ–º–æ-–æ—Ç—á–µ—Ç AI-–ø–æ–º–æ—â–Ω–∏–∫–∞</h2>
                            <p>–í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</p>
                        </div>
                        <pre>${reportContent}</pre>
                        <div class="actions">
                            <button onclick="window.print()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                            <button onclick="window.close()">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                </body>
                </html>
            `);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
        function showFullText(text) {
            alert(text);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∫–ª–∞—Å—Ç–µ—Ä–∞
        function viewClusterProblems(category, location) {
            alert(`–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã: ${category} –≤ ${location}`);
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
        function showAlert(alert) {
            showNotification(`üö® ${alert.title}: ${alert.category} - ${alert.location}`, 'alert');
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getCriticalityIcon(criticality) {
            const icons = ['üü¢', 'üü°', 'üü†', 'üî¥', 'üü£', '‚ö´'];
            return icons[Math.min(criticality, 5)] || '‚ö™';
        }

        function getSentimentIcon(sentiment) {
            const icons = {
                '–Ω–µ–≥–∞—Ç–∏–≤–Ω–∞—è': 'üò†',
                '–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è': 'üòê',
                '–ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è': 'üòä'
            };
            return icons[sentiment] || 'üòê';
        }

        function formatTime(dateString) {
            if (!dateString) return '–Ω–µ–¥–∞–≤–Ω–æ';

            try {
                const date = new Date(dateString);
                const now = new Date();
                const diff = Math.floor((now - date) / 1000);

                if (diff < 60) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
                if (diff < 3600) return `${Math.floor(diff / 60)} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
                if (diff < 86400) return `${Math.floor(diff / 3600)} —á. –Ω–∞–∑–∞–¥`;
                return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            } catch {
                return dateString;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            if (!container) return;

            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <strong>${type === 'alert' ? 'üö®' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</strong>
                    <span>${message}</span>
                </div>
                <button onclick="this.parentElement.remove()" class="notification-close">√ó</button>
            `;

            container.appendChild(notification);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
